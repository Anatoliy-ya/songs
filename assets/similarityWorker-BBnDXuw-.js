(function(){"use strict";const p=["allTimeRank","trackScore","spotifyStreams","spotifyPlaylistCount","spotifyPlaylistReach","spotifyPopularity","youtubeViews","youtubeLikes","tiktokPosts","tiktokLikes","tiktokViews","youtubePlaylistReach","appleMusicPlaylistCount","airplaySpins","siriusXMSpins","deezerPlaylistCount","deezerPlaylistReach","amazonPlaylistCount","pandoraStreams","pandoraTrackStations","soundcloudStreams","shazamCounts","tidalPopularity"];function g(s,i){let n=0,e=0,t=0;for(const o of p){const a=typeof s[o]=="number"?s[o]:0,r=typeof i[o]=="number"?i[o]:0;!isNaN(a)&&!isNaN(r)&&(n+=a*r,e+=a*a,t+=r*r)}return e=Math.sqrt(e),t=Math.sqrt(t),e===0||t===0?0:n/(e*t)}function M(s,i,n=10){return i.filter(t=>t!==s).map(t=>({song:t,similarity:g(s,t)})).sort((t,o)=>o.similarity-t.similarity).slice(0,n).map(t=>t.song)}function f(s,i){return Math.sqrt(p.reduce((n,e)=>{const t=typeof s[e]=="number"?s[e]:0,o=typeof i[e]=="number"?i[e]:0;return n+Math.pow(t-o,2)},0))}function C(s,i){const n=[],e=[...s];for(;n.length<i&&e.length>0;){const t=Math.floor(Math.random()*e.length);n.push(e[t]),e.splice(t,1)}return n}function P(s,i,n=50){const e=s.map(a=>{const r={...a};return p.forEach(m=>{(r[m]===null||r[m]===void 0)&&(r[m]=0)}),r});let t=Array.from({length:i},()=>[]),o=C(e,i);for(let a=0;a<n;a++){t=t.map(()=>[]);for(const l of e){const c=o.reduce((u,d,y,h)=>f(l,d)<f(l,h[u])?y:u,0);t[c].push(l)}const r=t.map((l,c)=>{if(l.length===0)return o[c];const u={};return p.forEach(d=>{const y=l.reduce((h,k)=>h+(typeof k[d]=="number"?k[d]:0),0);u[d]=y/l.length}),u});if(r.every((l,c)=>f(l,o[c])<.1)){console.log("Converged");break}o=r}return t}console.log("@worker"),self.onmessage=s=>{const i=P(s.data,Math.floor(Math.sqrt(s.data.length)));console.log("@clusters worker",i);const n=i.flatMap(e=>e.map(t=>({...t,similarities:M(t,e,10).map(o=>({id:o.id,similarity:g(t,o)}))})));console.log("@results worker",n),self.postMessage(n)}})();
